apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: apps
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa
            namespace: apps

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: livekit-credentials
  namespace: apps
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: livekit-credentials
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        LIVEKIT_URL: "{{ .LIVEKIT_URL }}"
        LIVEKIT_API_KEY: "{{ .LIVEKIT_API_KEY }}"
        LIVEKIT_API_SECRET: "{{ .LIVEKIT_API_SECRET }}"
        OPENAI_API_KEY: "{{ .OPENAI_API_KEY }}"
        DEEPGRAM_API_KEY: "{{ .DEEPGRAM_API_KEY }}"
        CARTESIA_API_KEY: "{{ .CARTESIA_API_KEY }}"
        ELEVEN_API_KEY: "{{ .ELEVEN_API_KEY }}"
        ASSEMBLYAI_API_KEY: "{{ .ASSEMBLYAI_API_KEY }}"
  data:
    - secretKey: LIVEKIT_URL
      remoteRef:
        key: livekit-agent-secrets
        property: LIVEKIT_URL
    - secretKey: LIVEKIT_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: LIVEKIT_API_KEY
    - secretKey: LIVEKIT_API_SECRET
      remoteRef:
        key: livekit-agent-secrets
        property: LIVEKIT_API_SECRET
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: OPENAI_API_KEY
    - secretKey: DEEPGRAM_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: DEEPGRAM_API_KEY
    - secretKey: CARTESIA_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: CARTESIA_API_KEY
    - secretKey: ELEVEN_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: ELEVEN_API_KEY
    - secretKey: ASSEMBLYAI_API_KEY
      remoteRef:
        key: livekit-agent-secrets
        property: ASSEMBLYAI_API_KEY

